<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <style>

    .bar {
      fill: steelblue;
    }

    .bar:hover {
      fill: brown;
    }

    .toolTip {
      position: absolute;
      display: none;
      min-width: 80px;
      height: auto;
      background: none repeat scroll 0 0 #ffffff;
      border: 1px solid #6F257F;
      padding: 14px;
      text-align: center;
    }

    h2 {
      font-size : 120%;
      color:#489450;
    }

    h3 {
      font-size : 180%;
      color:#696969;
      text-align: center;
    }

    .xaxis text {
      color:blue;
    }

    .yaxis text {
      color:blue;
    }

    #svgcontainer {
    display: inline-block;
    }

    #explcontainer {
        display: inline-block;
    }

    </style>
    
    <h3>xxxx</h3>
    <div id="wrapper">

      <div id = "svgcontainer">
            <br/>
            <h2>Dataset</h2>
            <p style="color:#789410;font-size:110%">Data only for xx</p>
            <button style="padding: 10px 20px; text-align: center;font-size: 16px;margin: 4px 2px;">Switch dataset</button>
      </div>

       <div id = "explcontainer">
            <h2>What, why and how ? Understanding this visualization thanks to abstraction</h2>
            <p style="color:#789410;font-size:110%">What ?</p>
            <p style="color:#111111;">
              This visualization uses open data from data.gov.com. The aim is to show some interesting insights about this data : this is the principal objective. The other ones are more academic, like use d3 and publish the web page on githubPages. The technologies used are d3 (javascript), HTML, CSS and git (nodejs for developing with a local server). There is no specific prerequisites for enjoying the visualization neither for using the code available in github.
              To be more precise about these insights, in the following paragraphs we will explain what were our data (through data abstraction), why this visualization (through task abstraction) and the reason of how we choice to present the data (idioms : visual encoding and interaction) ; thanks to that, we have been able to answer to the title question : Colombian migration : where do people go more ? And who are they ?
              <br/><br/>
              What ?
              <br/><br/>
      </div>

    </div>
    <p style="font-size:90%">The data used come from the Colombian open data website - direct link <a href="https://www.datos.gov.co/api/views/nmxb-8juf/rows.csv?accessType=DOWNLOAD&bom=true&format=true">here</a></p>
    <p style="font-size:90%">This project is under <a href="https://opensource.org/licenses/MIT">MIT license.</a></p>
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <script>

      // Const margin data for viz
      const width = 850;
      const height = 500;
      const margin = {top: 5, right: 70, bottom: 50, left: 50};
      const iwidth = width - margin.left -margin.right;
      const iheight = height - margin.top - margin.bottom;

      // Const bar chart
      const barwidth = 20;

      // SVG and g elements
      var svg = d3.select("#svgcontainer")
          .append("svg")
          .attr("width", iwidth + margin.left + margin.right)
          .attr("height", iheight + margin.top + margin.bottom);

      var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      //Tooltip var
      var tooltip = d3.select("body").append("div").attr("class", "toolTip");

      //Dataset current index
      var dataIndex=1;

      var datasetsTitles = ["Total of people", "Average age", "Male rate", "Female rate", "No gender registered rate", "PhD level of study rate", "Primary level of study rate", "Children rate", "Adults rate", "Elderly people rate"];

      var maxIndex = datasetsTitles.length;

      // Original ata var
      var dataOrigin;

      // Dataset 1,2,3,4,5,6,7,8,9,10
      var dataMonth1, dataCountryList2, dataCountryList3, dataCountryList4, dataCountryList5, dataCountryList6, dataCountryList7, dataCountryList8, dataCountryList9, dataCountryList10;

      //Var for axis x and y
      var xDomain, yDomain, xaxis, yaxis, x, y;

      // Load csv with promise
      d3.csv('https://raw.githubusercontent.com/pierreraimbaud/CapacitacionesColombia/master/Calendario_de_Capacitaciones__Iniciativa_Datos_Abiertos.csv').then(function(data) {
          dataOrigin = data;
          console.log(dataOrigin);
          //Create bar chart
          createBar();
      });

      //button to swap over datasets
      d3.select("button").on("click",function(){
          updateBar();
      });//end click function

      //Create bar chart
      function createBar(){

        //Set dataset title
        d3.select("h2").text("Dataset "+dataIndex + ": by country - " + datasetsTitles[dataIndex-1]);

        //Data preparation (2 datasets)
        prepareDatasets();        

        //Create Axis
        addAxisForBarChar();

        //Create Bar chart (rect)
       // addBarCharRects();
      }
/*
      //Add the axis for bar chart
      function addAxisForBarChar(){

        // X scale definition
        x = d3.scaleBand().rangeRound([0, iwidth])
          .paddingInner(1)
          .paddingOuter(1);

        x.domain((eval("dataCountryList"+dataIndex)).map(function(d){
         return d.value.isoCode;}));

        // Y scale definition
        y = d3.scaleLinear().rangeRound([iheight, 0]);

        y.domain([0, d3.max(eval("dataCountryList"+dataIndex), function(d){
            return +d.value.amount})]);

        // Axis x
        xaxis = g.append('g').attr('class', 'xaxis')
            .call(d3.axisBottom(x))
            .attr("transform", `translate(0,${iheight})`)
            .attr("class", "xaxis");

        // Axis y  
        yaxis = g.append('g').attr('class', 'yaxis')
            .call(d3.axisLeft(y));
      }

      //Add the rect (bar chart)
      function addBarCharRects(){

        //Add rect
        var rect = g.selectAll(".bar")
          .data(eval("dataCountryList"+dataIndex))
          .enter().append("rect")
          .attr("class", "bar");

        //Add rect attributes
        var attrX = rect.attr("x", function (d) {
              return x(d.value.isoCode)-barwidth/2;
            })

        var attrY = rect.attr("y", function (d) {
              return y(d.value.amount);
            });

        rect.attr("width", barwidth)
            .attr("height", function (d) {
              return height - y(d.value.amount)-(margin.top+margin.bottom);
            });

        //Add rect mouse event
        rect.on("mousemove", function(d){
              tooltip
                .style("left", d3.event.pageX - 70 + "px")
                .style("top", d3.event.pageY - 90 + "px")
                .style("display", "inline-block")
                .html(d.key + ": " +(d.value.amount));
            })
            .on("mouseout", function(d){ tooltip.style("display", "none");});   
      }
*/
      //Prepare datasets for bar chart
      function prepareDatasets(){

        //Nest data for getting it as (key=country, isoCode=ISO, amount=total of people, value=other data)
        var dataMonth = d3.nest()
          .key(function(d){
            return d.Month;
          })
          .rollup(function(values) { return values.length; })
          .entries(dataOrigin);

        console.log(dataMonth);
        
        dataMonth.sort(function(x, y){
          return d3.ascending(+x.key, +y.key);
        });

        var i;
        var total=0;
        for (i = 0; i < dataMonth.length; i++) { 
          switch(dataMonth[i].key) {
            case "01":
            case "02":
            case "03":
            case "04":
            case "05":
            case "06":
            case "07":
            case "08":
            case "09":
                dataMonth[i].value=dataMonth[i].value/3;
                total+=dataMonth[i].value;
                break;
            case "10":
            case "11":
            case "12":
                dataMonth[i].value=dataMonth[i].value/2;
                total+=dataMonth[i].value;
                break;
          }
        }
        console.log(dataMonth);
        for (i = 0; i < dataMonth.length; i++) {
          dataMonth[i].value=(dataMonth[i].value/total*100).toFixed(2);
        }
dataMonth1=dataMonth;
        console.log(dataMonth1);
      }

       //Add the axis for bar chart
      function addAxisForBarChar(){

        // X scale definition
        // x = d3.scaleBand().rangeRound([0, iwidth])
        //   .paddingInner(1)
        //   .paddingOuter(1);

        // x.domain(dataMonth1).map(function(d){
        //  return +d.key;});
         x = d3.scaleLinear().rangeRound([iheight, 0]);
        var max = d3.max(dataMonth1, function(d){
          return +d.key});
        x.domain([max,0]);

        // Y scale definition
        y = d3.scaleLinear().rangeRound([iheight, 0]);
        var max = d3.max(dataMonth1, function(d){
          return +d.value});
        y.domain([0,max]);

        // Axis x
        xaxis = g.append('g').attr('class', 'xaxis')
            .call(d3.axisBottom(x))
            .attr("transform", `translate(0,${iheight})`)
            .attr("class", "xaxis");

        // Axis y  
        yaxis = g.append('g').attr('class', 'yaxis')
            .call(d3.axisLeft(y));
     

 // Add the line which join the points
            const line = d3.line()
    .x( d=> x(d.key))
    .y( d=> y(d.value));
          
          // Path element
          g.append("path")
            .attr("class", "line")
            .attr("d", line(dataMonth1))
            .style("stroke", "grey")
            .style("fill", "none");
 }
    </script>

    <div class="wrapper">
      <header>
        <p><a href="">Link of this page - for sharing for example</a></p>
      </header>
      <section>
        <p class="view"><a href="https://github.com/pierreraimbaud/ColombiansAbroadViz">Project URL on GitHub <small>pierreraimbaud/ColombiansAbroadViz</small></a>   -   <a style="font-size:90%" href="https://github.com/pierreraimbaud/ColombiansAbroadViz#markdown">Markdown link</a></p>        
      </section>
      <footer>
        <p>Author and link : this project is maintained by <a href="https://github.com/pierreraimbaud">pierreraimbaud</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src=""></script>
    
  </body>
</html>